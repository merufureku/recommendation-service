resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowType: COUNT_BASED           # Count-based window (good for moderate traffic)
        slidingWindowSize: 20                    # Evaluate last 20 calls
        minimumNumberOfCalls: 10                 # Don’t trip too early
        failureRateThreshold: 50                 # 50% failure → OPEN
        slowCallRateThreshold: 50                # 50% slow calls → OPEN
        slowCallDurationThreshold: 2s            # >2s is considered slow
        waitDurationInOpenState: 30s             # Stay OPEN for 30s
        permittedNumberOfCallsInHalfOpenState: 3 # Probe with 3 calls
        automaticTransitionFromOpenToHalfOpenEnabled: true
        recordExceptions:
          - java.io.IOException
          - java.net.ConnectException
          - java.net.SocketTimeoutException
          - org.springframework.web.client.HttpServerErrorException
          - java.util.concurrent.TimeoutException

    instances:
      collectionService:
        baseConfig: default

      reviewService:
        baseConfig: default

      fragranceService:
        baseConfig: default

      metadataService:
        baseConfig: default
